<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>靠谱-微信第三方平台管理系统</title>
    <link href="../../../../img/logo-sig.png" rel="shortcut icon">
    <link href="../../../scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../../scripts/fontawesome/css/font-awesome.min.css" rel="stylesheet">
    <!--<link href="../styles/common.css" rel="stylesheet">-->
    <!--<link href="../styles/main.css" rel="stylesheet">-->
    <link href="../../../styles/style.min862f.css" rel="stylesheet">
</head>

<body class="gray-bg">
<div class="wrapper wrapper-content">
    <div class="row">
        <div class="col-sm-3">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <span class="label label-success pull-right">月</span>
                    <h5>收入</h5>
                </div>
                <div class="ibox-content">
                    <h1 class="no-margins" id="monthly_income">40 886,200</h1>
                    <!--<div class="stat-percent font-bold text-success">98% <i class="fa fa-bolt"></i></div>-->
                    <!--<small>总收入</small>-->
                </div>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <span class="label label-info pull-right">全年</span>
                    <h5>订单</h5>
                </div>
                <div class="ibox-content">
                    <h1 class="no-margins" id="year_order_count">275,800</h1>
                    <!--<div class="stat-percent font-bold text-info">20% <i class="fa fa-level-up"></i></div>-->
                    <!--<small>新订单</small>-->
                </div>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <span class="label label-primary pull-right">今天</span>
                    <h5>访客</h5>
                </div>
                <div class="ibox-content">
                    <h1 class="no-margins" id="today_visitor">106,120</h1>
                    <!--<div class="stat-percent font-bold text-navy">44% <i class="fa fa-level-up"></i></div>-->
                    <!--<small>新访客</small>-->
                </div>
            </div>
        </div>
        <div class="col-sm-3">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <span class="label label-danger pull-right">最近一个月</span>
                    <h5>活跃用户</h5>
                </div>
                <div class="ibox-content">
                    <h1 class="no-margins" id="monthly_visitor">80,600</h1>
                    <!--<div class="stat-percent font-bold text-danger">38% <i class="fa fa-level-down"></i></div>-->
                    <!--<small>12月</small>-->
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>订单</h5>
                    <!--<div class="pull-right">-->
                    <!--<div class="btn-group">-->
                    <!--<button type="button" class="btn btn-xs btn-white active">天</button>-->
                    <!--<button type="button" class="btn btn-xs btn-white">月</button>-->
                    <!--<button type="button" class="btn btn-xs btn-white">年</button>-->
                    <!--</div>-->
                    <!--</div>-->
                </div>
                <div class="ibox-content">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="flot-chart">
                                <div class="flot-chart-content" id="flot-dashboard-chart"></div>
                            </div>
                        </div>
                        <!--<div class="col-sm-3">-->
                        <!--<ul class="stat-list">-->
                        <!--<li>-->
                        <!--<h2 class="no-margins">2,346</h2>-->
                        <!--<small>订单总数</small>-->
                        <!--<div class="stat-percent">48% <i class="fa fa-level-up text-navy"></i>-->
                        <!--</div>-->
                        <!--<div class="progress progress-mini">-->
                        <!--<div style="width: 48%;" class="progress-bar"></div>-->
                        <!--</div>-->
                        <!--</li>-->
                        <!--<li>-->
                        <!--<h2 class="no-margins ">4,422</h2>-->
                        <!--<small>最近一个月订单</small>-->
                        <!--<div class="stat-percent">60% <i class="fa fa-level-down text-navy"></i>-->
                        <!--</div>-->
                        <!--<div class="progress progress-mini">-->
                        <!--<div style="width: 60%;" class="progress-bar"></div>-->
                        <!--</div>-->
                        <!--</li>-->
                        <!--<li>-->
                        <!--<h2 class="no-margins ">9,180</h2>-->
                        <!--<small>最近一个月销售额</small>-->
                        <!--<div class="stat-percent">22% <i class="fa fa-bolt text-navy"></i>-->
                        <!--</div>-->
                        <!--<div class="progress progress-mini">-->
                        <!--<div style="width: 22%;" class="progress-bar"></div>-->
                        <!--</div>-->
                        <!--</li>-->
                        <!--</ul>-->
                        <!--</div>-->
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="../../../scripts/jquery.min.js"></script>
<script type="text/javascript" src="../../../scripts/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../../../js/env.config.js"></script>
<script type="text/javascript" src="../../../scripts/global/app.common.js"></script>

<script type="text/javascript" src="../../../scripts/flot/jquery.flot.js"></script>
<script type="text/javascript" src="../../../scripts/flot/jquery.flot.tooltip.min.js"></script>
<script type="text/javascript" src="../../../scripts/flot/jquery.flot.spline.js"></script>
<script type="text/javascript" src="../../../scripts/flot/jquery.flot.resize.js"></script>
<script type="text/javascript" src="../../../scripts/flot/jquery.flot.pie.js"></script>
<script type="text/javascript" src="../../../scripts/flot/jquery.flot.symbol.js"></script>
<script type="text/javascript" src="../../../scripts/easypiechart/jquery.easypiechart.js"></script>

<script type="text/javascript" src="../../../scripts/local/app.shop.common.js"></script>

<script>
    shopBase.getShopInfo(function (shopInfoData) {
        console.log(shopInfoData);
        ajax.getAjaxData({
            url: 'merchant/shops/' + shopInfoData.shop_id + '/dashboard',
            success: function (data) {
                $("#monthly_income").text(data.monthlyIncome);
                $("#year_order_count").text(data.yearOrderCount);
                $("#today_visitor").text(data.todayVisitor);
                $("#monthly_visitor").text(data.monthlyVisitor);

                console.log(data);

                var data3 = [];
                data.orderDateToNum.forEach(function (item) {
                    var data_t = [new Date(item.datePatternStr.replace(/-/g, "/")).getTime(), item.totalNum];
                    data3.push(data_t);
                });

                var data2 = [];
                data.orderPayDateToNum.forEach(function (item) {
                    var orderPayDate = [new Date(item.datePatternStr.replace(/-/g, "/")).getTime(), item.totalNum];
                    data2.push(orderPayDate);
                });

                console.log(data3);
                console.log(data2);
                var dataset = [{
                    label: "订单数",
                    data: data3
                    , color: "#1ab394",
                    bars: {show: true, align: "center", barWidth: 24 * 60 * 60 * 600, lineWidth: 0}
                }, {
                    label: "付款数",
                    data: data2,
//                    yaxis: 2,
                    color: "#464f88",
                    lines: {
                        lineWidth: 1,
                        show: true,
                        fill: true,
                        fillColor: {colors: [{opacity: 0.2}, {opacity: 0.2}]}
                    },
                    splines: {show: false, tension: 0.6, lineWidth: 1, fill: 0.1},
                }];

                var options = {
                    xaxis: {
                        mode: "time",
//                        tickSize: [3, "day"],
//                        tickLength: 0,
                        axisLabel: "Date",
                        axisLabelUseCanvas: true,
                        axisLabelFontSizePixels: 12,
                        axisLabelFontFamily: "Arial",
                        axisLabelPadding: 10,
                        color: "#838383"
                    },
                    yaxes: [{
                        position: "left",
//                        max: 1070,
                        color: "#838383",
                        axisLabelUseCanvas: true,
                        axisLabelFontSizePixels: 12,
                        axisLabelFontFamily: "Arial",
                        axisLabelPadding: 3
                    }, {
                        position: "right",
                        clolor: "#838383",
                        axisLabelUseCanvas: true,
                        axisLabelFontSizePixels: 12,
                        axisLabelFontFamily: " Arial",
                        axisLabelPadding: 67
                    }],
                    legend: {noColumns: 1, labelBoxBorderColor: "#000000", position: "nw"},
                    grid: {hoverable: false, borderWidth: 0, color: "#838383"}
                };

                $.plot($("#flot-dashboard-chart"), dataset, options);
            }
        });
    });
</script>
</body>
</html>
